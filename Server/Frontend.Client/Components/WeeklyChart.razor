@using System.Net
@using ApexCharts
@using MudBlazor.Extensions
@using Shared.Models
@inject HttpClient Http

<ApexChart TItem="MyData"
           Options="chartOptions" Height="150">

    <ApexPointSeries TItem="MyData"
                     Items="Data"
                     Name="Distance"
                     SeriesType="SeriesType.Line"
                     XValue="e => e.Category"
                     YValue="e => e.Distance"
                     Color="#685ce4"
    />
</ApexChart>

@code {
    // TODO: Implement Connection to End Point and fetch the distance data for every weekday
    private List<MyData> Data { get; set; } = new();

    private ApexChartOptions<MyData> chartOptions = new()
    {
        Chart = new Chart
        {
            Toolbar = new Toolbar
            {
                Show = false // Hides the download/export options
            },
        },
        Legend = new Legend
        {
            Show = false // Hides the legend
        }
    };
    
    protected override async Task OnInitializedAsync()
    {
        Data.Add(new MyData { Category = "Mon", Distance = 12 });
        Data.Add(new MyData { Category = "Tue", Distance = 43 });
        Data.Add(new MyData { Category = "Wed", Distance = 112 });
        Data.Add(new MyData { Category = "Thu", Distance = 0 });
        Data.Add(new MyData { Category = "Fri", Distance = 112 });
        Data.Add(new MyData { Category = "Sat", Distance = 22 });
        Data.Add(new MyData { Category = "Sun", Distance = 112 });
        await LoadWeeklyData();
    }
    
    private async Task LoadWeeklyData()
    {
        try
        {
            var response = await Http.GetFromJsonAsync<ApiResponse<List<WeeklyDistanceResponse>>>(
                "/api/activities/weekly-distance");

            if (response?.IsSuccess == true && response.Data != null)
            {
                Data = response.Data.Select(item => new MyData() 
                { 
                    Category = item.Day, 
                    Distance = item.Distance.As<int>()
                }).ToList();
            }
        }
        catch (Exception ex)
        {
            // TODO: log error 
        }
    }

    public class MyData
    {
        public string Category { get; set; }
        public int Distance { get; set; }
    }

}
